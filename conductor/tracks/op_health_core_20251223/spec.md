# Specification: Operational Health Core Implementation

## 1. Overview
This track focuses on completing the implementation of the "Operational Health Core" features in OpsIdentity. The goal is to align the data collection capabilities (PowerShell script) with the robust analysis and filtering logic already present in the backend.

## 2. Objectives
- Implement `Get-FSMOHealthCheck` in `NewAssessment.tsx` to validate FSMO role accessibility and time sync configuration.
- Implement `Get-TrustHealthValidation` in `NewAssessment.tsx` to actively validate trust relationships and check password age.
- Refine `Get-ADSiteTopology` in `NewAssessment.tsx` to ensure it captures all topology issues defined in the product requirements (Sites without subnets, etc.).
- Ensure all new data structures generated by the PowerShell script map correctly to the backend's `extractCategoryData` logic.

## 3. Detailed Requirements

### 3.1 FSMO Health Check
- **Function:** `Get-FSMOHealthCheck`
- **Data to Collect:**
    - FSMO Role Holders (already in `Get-DomainControllerInfo` but needs consolidation).
    - **Accessibility Check:** Verify if FSMO role holders are reachable.
    - **PDC Time Sync:** Check the time source of the PDC Emulator (Must be external/NTP, not VM IC or CMOS).
    - **Single Point of Failure:** Detect if all roles are on a single DC.

### 3.2 Trust Health Validation
- **Function:** `Get-TrustHealthValidation`
- **Data to Collect:**
    - Active validation using `Test-ComputerSecureChannel` (where feasible/safe).
    - Trust Password Age (check `pwdLastSet` of the trust account).
    - SID Filtering status.

### 3.3 Site Topology Refinement
- **Function:** `Get-ADSiteTopology` (Update)
- **Data to Collect:**
    - Sites without Subnets (Critical).
    - Subnets without Sites.
    - Empty Sites (No DCs).
    - Connection analysis (Manual vs KCC).

### 3.4 Integration
- Update `generateScript` in `NewAssessment.tsx` to include these new functions in the generated PowerShell script.
- Verify that the JSON output structure matches what `server/server.js` expects for categories: `FSMORolesHealth`, `TrustHealth`, `Sites`.

## 4. Acceptance Criteria
- Generated PowerShell script includes `Get-FSMOHealthCheck`, `Get-TrustHealthValidation`, and updated `Get-ADSiteTopology`.
- Script executes successfully (mock/dry-run) and produces JSON with the new fields.
- Backend `extractCategoryData` successfully processes the new JSON structure.
